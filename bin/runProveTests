#! /bin/bash
# This script runs the compiler with RESOLVE files

# -e Terminates the script if a command fails
# -u Treats unset environment variables as error
# -f Disable filename expansion
# -o pipefail Prints all pipe errors to console
set -euf -o pipefail

# Arrays containing the files we are going to run
# the compile tests on.
FILESTOPROVE=($(cat bin/tests/filesToProve.txt | tr "\n" " "))

# Prepare to launch tests
echo ""
echo "---- PRE-EXECUTION SETUP ----"
cp RESOLVE/target/RESOLVE-Summer21a-jar-with-dependencies.jar RESOLVE-Workspace/RESOLVE/Main/resolve.jar
cd RESOLVE-Workspace/RESOLVE/Main/
echo "---- DONE WITH PRE-EXECUTION SETUP ----"

# Generate proves the following files
echo ""
echo "---- PROVING FILES ----"
for i in "${FILESTOPROVE[@]}"
do
   echo "Proving $i"
   java -jar resolve.jar -ccprove -nodebug -timeout 7000 -num_tries 3 $i
done
echo "---- DONE PROVING FILES ----"